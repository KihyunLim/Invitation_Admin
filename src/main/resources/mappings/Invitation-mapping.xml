<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="InvitationDAO">
	<select id="getMemberInfo" resultType="memberInfo">
		SELECT
			ID,
			NAME
		FROM
			USERES
		WHERE
			ID = #{id}
			AND DELETEFLAG = 'N'
		;
	</select>
	
	<select id="getLastInsertID" resultType="int">
		SELECT
			LAST_INSERT_ID()
		;
	</select>
	
	<insert id="registerInvitation">
		INSERT INTO
			INVITATION_LIST (
				SEQ
				, ID
				, NAME
				, VISIBLE
				, DATE_BEGIN
				, DATE_END
				, FORMCODE
				, USE_EACH_IMAGE
				, USE_LS
				, USE_PYEBAEK
				, USE_G
				, USE_SM
				, DATETIME_REGISTER
				, DATETIME_UPDATE
			) 
			VALUES (
				null
				, #{invitationVO.id}
				, (SELECT NAME FROM USERES WHERE ID=#{invitationVO.id})
				, #{invitationVO.visible}
				, #{invitationVO.periodBegin}
				, #{invitationVO.periodEnd}
				, #{invitationVO.formCode}
				, #{invitationVO.useEachImage}
				, #{invitationVO.useLS}
				, #{invitationVO.usePyebaek}
				, #{invitationVO.useG}
				, #{invitationVO.useSM}
				, null
				, null
			)
		;
	</insert>
	
	<insert id="insertMainInfo">
		INSERT INTO
			MAIN_INFO (
				SEQ
				, INV_SEQ
				, ID
				, DATE_WEDDING
				, TIME_WEDDING
				, X_PLACE
				, Y_PLACE
				, ADDRESS
				, CONTENT_GROOM
				, CONTENT_BRIDE
				, SEQ_IMG_MAIN
				, YN_EACH_IMAGE
				, SEQ_IMG_GROOM
				, SEQ_IMG_BRIDE
				, DATETIME_REGISTER
				, DATETIME_UPDATE
			)
			VALUES (
				null
				, #{mainInfoVO.invSeq}
				, #{invitationVO.id}
				, #{mainInfoVO.dateWedding}
				, #{mainInfoVO.timeWedding}
				, #{mainInfoVO.placeX}
				, #{mainInfoVO.placeY}
				, #{mainInfoVO.address}
				, #{mainInfoVO.contentGroom}
				, #{mainInfoVO.contentBride}
				, #{mainInfoVO.seqImgMain}
				, #{mainInfoVO.useEachImage}
				, #{mainInfoVO.seqImgGroom}
				, #{mainInfoVO.seqImgBride}
				, null
				, null
			)
		;
	</insert>
	
	<insert id="insertLoveStory">
		INSERT INTO
			LOVE_STORY (
				SEQ
				, INV_SEQ
				, ID
				, IS_DELETE
				, DATE_STORY
				, TITLE
				, CONTENT
				, SEQ_IMAGE
				, DATETIME_REGISTER
				, DATETIME_UPDATE
			)
			VALUES 
			<foreach collection="loveStoryVO" item="item" open="(" close=")" separator="), (">
				null
				, #{mainInfoVO.invSeq}
				, #{invitationVO.id}
				, false
				, #{item.dateStory}
				, #{item.title}
				, #{item.content}
				, #{item.seqImage}
				, null
				, null
			</foreach>
		;
	</insert>
</mapper>