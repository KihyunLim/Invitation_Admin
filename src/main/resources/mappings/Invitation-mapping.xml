<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="InvitationDAO">
	<resultMap id="resultMainInfoVO" type="mainInfoVO">
		<result column="SEQ" property="seq" />
		<result column="INV_SEQ" property="invSeq" />
		<result column="ID" property="id" />
		<result column="DATE_WEDDING" property="dateWedding" />
		<result column="TIME_WEDDING" property="timeWedding" />
		<result column="X_PLACE" property="placeX" />
		<result column="Y_PLACE" property="placeY" />
		<result column="ADDRESS" property="address" />
		<result column="CONTENT_GROOM" property="contentGroom" />
		<result column="CONTENT_BRIDE" property="contentBride" />
		<result column="SEQ_IMG_MAIN" property="seqImgMain" />
		<result column="YN_EACH_IMAGE" property="useEachImage" />
		<result column="SEQ_IMG_GROOM" property="seqImgGroom" />
		<result column="SEQ_IMG_BRIDE" property="seqImgBride" />
		<result column="DATETIME_REGISTER" property="dateTimeRegister" />
		<result column="DATETIME_UPDATE" property="dateTimeUpdate" />
	</resultMap>
	
	<resultMap id="resultInvitationVO" type="invitationVO">
		<result column="SEQ" property="seq" />
		<result column="ID" property="id" />
		<result column="NAME" property="name" />
		<result column="VISIBLE" property="visible" />
		<result column="DATE_BEGIN" property="periodBegin" />
		<result column="DATE_END" property="periodEnd" />
		<result column="FORMCODE" property="formCode" />
		<result column="USE_EACH_IMAGE" property="useEachImage" />
		<result column="USE_LS" property="useLS" />
		<result column="USE_PYEBAEK" property="usePyebaek" />
		<result column="USE_G" property="useG" />
		<result column="USE_SM" property="useSM" />
		<result column="DATETIME_REGISTER" property="dateTimeRegister" />
		<result column="DATETIME_UPDATE" property="dateTimeUpdate" />
	</resultMap>

	<select id="getMemberInfo" resultType="memberInfo">
		SELECT
			ID,
			NAME
		FROM
			USERES
		WHERE
			ID = #{id}
			AND DELETEFLAG = 'N'
		;
	</select>
	
	<select id="getLastInsertID" resultType="int">
		SELECT
			LAST_INSERT_ID()
		;
	</select>
	
	<insert id="registerInvitation">
		INSERT INTO
			INVITATION_LIST (
				SEQ
				, ID
				, NAME
				, VISIBLE
				, DATE_BEGIN
				, DATE_END
				, FORMCODE
				, USE_EACH_IMAGE
				, USE_LS
				, USE_PYEBAEK
				, USE_G
				, USE_SM
				, DATETIME_REGISTER
				, DATETIME_UPDATE
			) 
			VALUES (
				null
				, #{invitationVO.id}
				, (SELECT NAME FROM USERES WHERE ID=#{invitationVO.id})
				, #{invitationVO.visible}
				, #{invitationVO.periodBegin}
				, #{invitationVO.periodEnd}
				, #{invitationVO.formCode}
				, #{invitationVO.useEachImage}
				, #{invitationVO.useLS}
				, #{invitationVO.usePyebaek}
				, #{invitationVO.useG}
				, #{invitationVO.useSM}
				, null
				, null
			)
		;
	</insert>
	
	<insert id="insertMainInfo">
		INSERT INTO
			MAIN_INFO (
				SEQ
				, INV_SEQ
				, ID
				, DATE_WEDDING
				, TIME_WEDDING
				, X_PLACE
				, Y_PLACE
				, ADDRESS
				, CONTENT_GROOM
				, CONTENT_BRIDE
				, SEQ_IMG_MAIN
				, YN_EACH_IMAGE
				, SEQ_IMG_GROOM
				, SEQ_IMG_BRIDE
				, DATETIME_REGISTER
				, DATETIME_UPDATE
			)
			VALUES (
				null
				, #{mainInfoVO.invSeq}
				, #{mainInfoVO.id}
				, #{mainInfoVO.dateWedding}
				, #{mainInfoVO.timeWedding}
				, #{mainInfoVO.placeX}
				, #{mainInfoVO.placeY}
				, #{mainInfoVO.address}
				, #{mainInfoVO.contentGroom}
				, #{mainInfoVO.contentBride}
				, #{mainInfoVO.seqImgMain}
				, #{mainInfoVO.useEachImage}
				, #{mainInfoVO.seqImgGroom}
				, #{mainInfoVO.seqImgBride}
				, null
				, null
			)
		;
	</insert>
	
	<insert id="insertLoveStory">
		INSERT INTO
			LOVE_STORY (
				SEQ
				, INV_SEQ
				, ID
				, IS_DELETE
				, DATE_STORY
				, TITLE
				, CONTENT
				, SEQ_IMAGE
				, DATETIME_REGISTER
				, DATETIME_UPDATE
			)
			VALUES 
			<foreach collection="loveStoryVO" item="item" open="(" close=")" separator="), (">
				null
				, #{item.invSeq}
				, #{item.id}
				, #{item.isDelete}
				, #{item.dateStory}
				, #{item.title}
				, #{item.content}
				, #{item.seqImage}
				, null
				, null
			</foreach>
		;
	</insert>
	
	<insert id="insertWhenWhere">
		INSERT INTO
			WHEN_WHERE (
				SEQ
				, INV_SEQ
				, ID
				, FLAG_PYEBAEK
				, DATE_WW
				, TIME_WW
				, X_PLACE
				, Y_PLACE
				, ADDRESS
				, TITLE
				, CONTENT
				, DATETIME_REGISTER
				, DATETIME_UPDATE
			)
			VALUES
			<foreach collection="whenWhereVO" item="item" open="(" close=")" separator="), (">
				null
				, #{item.invSeq}
				, #{item.id}
				, #{item.flagPyebaek}
				, #{item.dateWedding}
				, #{item.timeWedding}
				, #{item.placeX}
				, #{item.placeY}
				, #{item.address}
				, #{item.title}
				, #{item.content}
				, null
				, null
			</foreach>
	</insert>
	
	<insert id="insertGallery">
		INSERT INTO
			GALLERY (
				SEQ
				, INV_SEQ
				, ID
				, IS_DELETE
				, SEQ_IMAGE
				, DATETIME_REGISTER
				, DATETIME_UPDATE
			)
			VALUES
			<foreach collection="galleryVO" item="item" open="(" close=")" separator="), (">
				null
				, #{item.invSeq}
				, #{item.id}
				, #{item.isDelete}
				, #{item.seqImage}
				, null
				, null
			</foreach>
	</insert>
	
	<select id="getMemberInvitation" resultMap="resultMainInfoVO">
		SELECT 
			*
		FROM
			MAIN_INFO
		WHERE
			ID = #{id}
		;
	</select>
</mapper>