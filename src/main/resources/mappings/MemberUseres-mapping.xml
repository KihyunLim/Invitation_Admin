<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="MemberUserDAO">
	<select id="getMemberList" resultType="userMemberList">
		SELECT
			U.ID
			, U.NAME
			, U.PHONE
			, (
				IFNULL((
					SELECT
						IL.VISABLE
					FROM
						INVITATION_LIST IL
					WHERE
						IL.ID = U.ID
						AND NOW() <![CDATA[>=]]> IL.DATE_BEGIN
						AND NOW() <![CDATA[<=]]> IL.DATE_END)
				, 'X')
			) AS STATUSSEE
		FROM
			USERES U
		WHERE
			U.DELETEFLAG <![CDATA[<>]]> 'Y'
		<if test="condition == 'id'">
			AND U.ID LIKE CONCAT('%', #{keyword}, '%')
		</if>
		<if test="condition == 'name'">
			AND U.NAME LIKE CONCAT('%', #{keyword}, '%')
		</if>
		<if test="condition == 'phone'">
			AND U.PHONE LIKE CONCAT('%', #{keyword}, '%')
		</if>
		LIMIT #{pageStart}, #{perPageNum};
	</select>
	
	<select id="getMemberListCount" resultType="int">
		SELECT
			COUNT(U.ID)
		FROM
			USERES U
		WHERE
			U.DELETEFLAG <![CDATA[<>]]> 'Y'
		<if test="condition == 'id'">
			AND U.ID LIKE CONCAT('%', #{keyword}, '%')
		</if>
		<if test="condition == 'name'">
			AND U.NAME LIKE CONCAT('%', #{keyword}, '%')
		</if>
		<if test="condition == 'phone'">
			AND U.PHONE LIKE CONCAT('%', #{keyword}, '%')
		</if>
		;
	</select>
</mapper>